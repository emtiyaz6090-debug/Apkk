<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deen - Ramadan 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&family=Amiri&display=swap');
        body { font-family: 'Hind Siliguri', sans-serif; background-color: #F8FAFC; overflow-x: hidden; }
        .header-gradient { background: linear-gradient(135deg, #1e1b4b 0%, #4338ca 100%); border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; }
        .page { display: none; min-height: 100vh; padding-bottom: 120px; }
        .page.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .font-arabic { font-family: 'Amiri', serif; text-align: right; direction: rtl; }
        .nav-btn { color: #64748b; transition: all 0.3s ease; }
        .nav-active { color: #4338ca !important; background: #f0f2ff; border-radius: 15px; }
        
        .main-card { margin-top: -70px; position: relative; z-index: 20; }
        
        #custom-toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 15px; padding: 16px; position: fixed; z-index: 200; left: 50%; bottom: 100px; transform: translateX(-50%); font-size: 14px; }
        #custom-toast.show { visibility: visible; animation: fadeinout 3s; }
        @keyframes fadeinout { 0%, 100% { opacity: 0; } 15%, 85% { opacity: 1; } }

        .tasbih-circle { width: 180px; height: 180px; border: 8px solid #4338ca; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; user-select: none; transition: transform 0.1s; background: white; margin: 0 auto; box-shadow: 0 10px 20px rgba(67, 56, 202, 0.1); }
        .tasbih-circle:active { transform: scale(0.95); }
        .spin { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="max-w-md mx-auto shadow-2xl bg-white relative">

    <audio id="surah-audio" preload="auto"></audio>
    <div id="custom-toast">বার্তা</div>

    <div id="page-home" class="page active">
        <div class="header-gradient pt-8 pb-24 px-6 text-white text-center relative">
            <h1 class="text-2xl font-black italic tracking-tighter mb-4">DEEN</h1>
            <div class="mb-4 inline-block px-6 py-2 rounded-2xl bg-white/10 backdrop-blur-md border border-white/20">
                <p id="countdown-label" class="text-[10px] uppercase font-bold tracking-widest opacity-80">লোড হচ্ছে...</p>
                <p id="live-timer" class="text-3xl font-black tracking-widest">00:00:00</p>
            </div>
            <div class="space-y-1">
                <p class="text-lg font-bold text-orange-300">১লা রমজান, ১৪৪৭ হিজরি</p>
                <p class="text-[10px] opacity-70">লক্ষ্মীপুর, বাংলাদেশ</p>
            </div>
        </div>

        <div class="px-5 main-card">
            <div class="bg-white p-6 rounded-[30px] shadow-xl border border-gray-100">
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100 text-center">
                        <p class="text-[10px] font-bold text-blue-500 uppercase">সেহরি শেষ</p>
                        <p id="suhur-time" class="font-black text-blue-900 text-xl">০৫:০৬</p>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-2xl border border-orange-100 text-center">
                        <p class="text-[10px] font-bold text-orange-600 uppercase">ইফতার</p>
                        <p id="iftar-time" class="font-black text-orange-900 text-xl">০৬:০২</p>
                    </div>
                </div>
                <div class="mt-6 border-t pt-4 flex justify-between items-center px-2">
                    <div>
                        <p class="text-gray-400 text-[10px] uppercase font-bold">পরবর্তী নামাজ</p>
                        <h2 id="next-prayer-name" class="text-xl font-black text-slate-800">লোড হচ্ছে</h2>
                    </div>
                    <h2 id="next-prayer-time" class="text-2xl font-black text-indigo-600">--:--</h2>
                </div>
            </div>
        </div>

        <div class="px-5 mt-8">
            <h3 class="font-bold text-slate-800 mb-4 px-2 text-sm">রমজান ক্যালেন্ডার ২০২৬ (লক্ষ্মীপুর)</h3>
            <div class="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden mb-10">
                <table class="w-full text-center text-[11px]">
                    <thead class="bg-indigo-50 text-indigo-900">
                        <tr><th class="py-3">রোজা</th><th>তারিখ</th><th>সেহরি</th><th>ইফতার</th></tr>
                    </thead>
                    <tbody id="ramadan-table-body" class="text-gray-600"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="page-quran" class="page px-5 pt-8">
        <h2 class="text-2xl font-black mb-6">আল-কুরআন</h2>
        <div id="surah-list" class="space-y-3 pb-10"></div>
    </div>

    <div id="surah-detail" class="fixed inset-0 bg-white z-[100] hidden overflow-y-auto p-6">
        <div class="flex justify-between items-center mb-6 sticky top-0 bg-white py-2 border-b">
            <button onclick="closeSurah()" class="text-indigo-600 font-bold"><i class="fa-solid fa-arrow-left mr-2"></i>পিছনে</button>
            <h2 id="surah-title" class="text-lg font-bold"></h2>
            <button id="play-btn" onclick="toggleAudio()" class="w-12 h-12 bg-indigo-600 text-white rounded-full flex items-center justify-center shadow-lg active:scale-90">
                <i class="fa-solid fa-play" id="play-icon"></i>
            </button>
        </div>
        <div id="ayats" class="space-y-10"></div>
    </div>

    <div id="page-tasbih" class="page px-5 pt-8 text-center">
        <h2 class="text-2xl font-black mb-10 text-slate-800">ডিজিটাল তসবিহ</h2>
        <div class="flex flex-col items-center justify-center space-y-8 mt-10">
            <div onclick="countTasbih()" class="tasbih-circle"><span id="tasbih-count" class="text-6xl font-black text-indigo-600">0</span></div>
            <button onclick="resetTasbih()" class="bg-red-50 text-red-500 px-10 py-3 rounded-2xl font-bold border border-red-100">রিসেট</button>
        </div>
    </div>

    <div id="page-duas" class="page px-5 pt-8">
        <h2 class="text-2xl font-black mb-6">দোয়া ও জিকির</h2>
        <div class="bg-orange-50 p-6 rounded-3xl border border-orange-100 mb-4 text-center">
            <p class="font-bold text-orange-800 mb-2">ইফতারের দোয়া</p>
            <p class="font-arabic text-xl mb-2">اَللَّهُمَّ لَّكَ صُمْتُ وَعَلَى رِزْقِكَ اَفْطَرْتُ</p>
            <p class="text-xs text-gray-600">আল্লাহুম্মা লাকা সুমতু ওয়া আলা রিজকিকা আফতারতু।</p>
        </div>
    </div>

    <nav class="fixed bottom-4 left-1/2 -translate-x-1/2 w-[90%] max-w-sm bg-white/95 backdrop-blur-md rounded-[25px] flex justify-around items-center py-3 z-50 shadow-2xl border border-gray-100">
        <button onclick="switchPage('home')" id="nav-home" class="nav-btn nav-active px-4 py-2"><i class="fa-solid fa-house-chimney"></i></button>
        <button onclick="switchPage('quran')" id="nav-quran" class="nav-btn px-4 py-2"><i class="fa-solid fa-book-quran"></i></button>
        <button onclick="switchPage('tasbih')" id="nav-tasbih" class="nav-btn px-4 py-2"><i class="fa-solid fa-fingerprint"></i></button>
        <button onclick="switchPage('duas')" id="nav-duas" class="nav-btn px-4 py-2"><i class="fa-solid fa-hands-praying"></i></button>
    </nav>

    <script>
        const audioPlayer = document.getElementById('surah-audio');
        const playIcon = document.getElementById('play-icon');
        const RAMADAN_START_DATE = new Date('2026-02-19T00:00:00');

        async function init() {
            await fetchPrayerTimes();
            generateRamadanTable();
            setInterval(updateLiveCountdown, 1000);
        }

        async function fetchPrayerTimes() {
            try {
                const res = await fetch('https://api.aladhan.com/v1/timingsByCity?city=Lakshmipur&country=Bangladesh&method=1');
                const data = await res.json();
                const t = data.data.timings;
                document.getElementById('suhur-time').innerText = t.Fajr;
                document.getElementById('iftar-time').innerText = t.Maghrib;
                updateNextPrayer(t);
            } catch (e) { showToast("ইন্টারনেট সংযোগ চেক করুন"); }
        }

        function updateNextPrayer(t) {
            const prayers = [{n:'ফজর',t:t.Fajr},{n:'যোহর',t:t.Dhuhr},{n:'আসর',t:t.Asr},{n:'মাগরিব',t:t.Maghrib},{n:'এশা',t:t.Isha}];
            let now = new Date();
            let currentMin = now.getHours() * 60 + now.getMinutes();
            let next = prayers[0];
            for (let p of prayers) {
                let [h, m] = p.t.split(':').map(Number);
                if ((h * 60 + m) > currentMin) { next = p; break; }
            }
            document.getElementById('next-prayer-name').innerText = next.n;
            document.getElementById('next-prayer-time').innerText = formatAMPM(next.t);
        }

        function updateLiveCountdown() {
            const now = new Date();
            const sTime = document.getElementById('suhur-time').innerText;
            const iTime = document.getElementById('iftar-time').innerText;
            if (sTime.includes('--')) return;

            const getT = (str) => { 
                const [h, m] = str.split(':').map(Number); 
                let d = new Date(); d.setHours(h, m, 0); return d; 
            };
            
            let suhur = getT(sTime);
            let iftar = getT(iTime);
            let target, label;

            if (now < suhur) { target = suhur; label = "সেহরি শেষ হতে বাকি"; }
            else if (now < iftar) { target = iftar; label = "ইফতারের বাকি"; }
            else { target = new Date(suhur); target.setDate(target.getDate() + 1); label = "পরবর্তী সেহরি"; }

            const diff = target - now;
            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);

            document.getElementById('countdown-label').innerText = label;
            document.getElementById('live-timer').innerText = `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        function generateRamadanTable() {
            let html = "";
            const baseSuhur = document.getElementById('suhur-time').innerText;
            const baseIftar = document.getElementById('iftar-time').innerText;
            for (let i = 1; i <= 30; i++) {
                let d = new Date(RAMADAN_START_DATE); d.setDate(d.getDate() + (i - 1));
                html += `<tr class="border-b border-gray-50">
                    <td class="py-3 font-bold text-indigo-600">${i}</td>
                    <td>${d.getDate()} ফেব্রুয়ারি</td>
                    <td class="text-blue-600">${baseSuhur}</td>
                    <td class="text-orange-600 font-bold">${baseIftar}</td>
                </tr>`;
            }
            document.getElementById('ramadan-table-body').innerHTML = html;
        }

        async function openQuran() {
            const container = document.getElementById('surah-list');
            if (container.innerHTML !== "") return;
            const res = await fetch('https://api.alquran.cloud/v1/surah');
            const data = await res.json();
            container.innerHTML = data.data.map(s => `
                <div onclick="loadSurah(${s.number}, '${s.englishName}')" class="p-4 bg-white border border-gray-100 rounded-2xl flex justify-between items-center shadow-sm active:bg-indigo-50">
                    <div class="flex items-center space-x-3">
                        <span class="w-8 h-8 bg-indigo-600 text-white rounded-lg flex items-center justify-center text-xs font-bold">${s.number}</span>
                        <p class="font-bold text-sm">${s.englishName}</p>
                    </div>
                    <span class="font-arabic text-xl text-indigo-900">${s.name}</span>
                </div>`).join('');
        }

        async function loadSurah(num, name) {
            document.getElementById('surah-detail').classList.remove('hidden');
            document.getElementById('surah-title').innerText = name;
            document.getElementById('ayats').innerHTML = "<p class='text-center py-10 opacity-50'>আয়াত লোড হচ্ছে...</p>";
            
            // Fixed Audio URL: Using EveryAyah stable repository
            const surahId = String(num).padStart(3, '0');
            audioPlayer.src = `https://everyayah.com/data/Alafasy_128kbps/${surahId}001.mp3`; // Plays first Ayah as preview or full Surah link can be added
            // Alternative: Full Surah Mishary Rashid
            audioPlayer.src = `https://server8.mp3quran.net/afs/${surahId}.mp3`;
            
            audioPlayer.load(); // Mandatory to load before play
            playIcon.className = "fa-solid fa-play";

            try {
                const [ar, bn] = await Promise.all([
                    fetch(`https://api.alquran.cloud/v1/surah/${num}`).then(r => r.json()), 
                    fetch(`https://api.alquran.cloud/v1/surah/${num}/bn.bengali`).then(r => r.json())
                ]);
                document.getElementById('ayats').innerHTML = ar.data.ayahs.map((a, i) => `
                    <div class="border-b border-gray-100 pb-6">
                        <p class="font-arabic text-2xl mb-3 text-slate-800 leading-relaxed">${a.text}</p>
                        <p class="text-sm text-gray-500">${bn.data.ayahs[i].text}</p>
                    </div>`).join('');
            } catch (e) { showToast("তথ্য লোড করতে ব্যর্থ"); }
        }

        function toggleAudio() {
            if (!audioPlayer.src) return;
            
            if (audioPlayer.paused) {
                const playPromise = audioPlayer.play();
                if (playPromise !== undefined) {
                    playIcon.className = "fa-solid fa-circle-notch spin";
                    playPromise.then(_ => {
                        playIcon.className = "fa-solid fa-pause";
                    }).catch(error => {
                        showToast("অডিও এরর: সুরাহটি আবার সিলেক্ট করুন");
                        playIcon.className = "fa-solid fa-play";
                    });
                }
            } else {
                audioPlayer.pause();
                playIcon.className = "fa-solid fa-play";
            }
        }

        function switchPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('nav-active'));
            document.getElementById('nav-' + id).classList.add('nav-active');
            if (id === 'quran') openQuran();
            if (id !== 'quran') { audioPlayer.pause(); document.getElementById('surah-detail').classList.add('hidden'); }
            window.scrollTo(0, 0);
        }

        function formatAMPM(t) {
            let [h, m] = t.split(':').map(Number);
            let ampm = h >= 12 ? 'PM' : 'AM';
            h = h % 12 || 12;
            return `${h}:${String(m).padStart(2, '0')} ${ampm}`;
        }

        function closeSurah() { document.getElementById('surah-detail').classList.add('hidden'); audioPlayer.pause(); }
        function showToast(msg) { const t = document.getElementById("custom-toast"); t.innerText = msg; t.className = "show"; setTimeout(() => t.className = "", 3000); }
        let tCount = 0; 
        function countTasbih() { tCount++; document.getElementById('tasbih-count').innerText = tCount; if ('vibrate' in navigator) navigator.vibrate(50); }
        function resetTasbih() { tCount = 0; document.getElementById('tasbih-count').innerText = 0; }

        window.onload = init;
    </script>
</body>
  </html>
